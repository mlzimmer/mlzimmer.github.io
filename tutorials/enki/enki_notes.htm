<html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=Generator content="Microsoft Word 15 (filtered)">
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Courier;
	panose-1:2 7 4 9 2 2 5 2 4 4;}
@font-face
	{font-family:Wingdings;
	panose-1:5 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
@font-face
	{font-family:"Calibri Light";
	panose-1:2 15 3 2 2 2 4 3 2 4;}
@font-face
	{font-family:"Segoe UI";
	panose-1:2 11 5 2 4 2 4 2 2 3;}
@font-face
	{font-family:Consolas;
	panose-1:2 11 6 9 2 2 4 3 2 4;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:8.0pt;
	margin-left:0in;
	line-height:107%;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
h1
	{mso-style-link:"Heading 1 Char";
	margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:0in;
	margin-bottom:.0001pt;
	line-height:107%;
	page-break-after:avoid;
	font-size:16.0pt;
	font-family:"Calibri Light",sans-serif;
	color:#2F5496;
	font-weight:normal;}
h2
	{mso-style-link:"Heading 2 Char";
	margin-top:2.0pt;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:0in;
	margin-bottom:.0001pt;
	line-height:107%;
	page-break-after:avoid;
	font-size:13.0pt;
	font-family:"Calibri Light",sans-serif;
	color:#2F5496;
	font-weight:normal;}
h3
	{mso-style-link:"Heading 3 Char";
	margin-right:0in;
	margin-left:0in;
	font-size:13.5pt;
	font-family:"Times New Roman",serif;
	font-weight:bold;}
p.MsoToc1, li.MsoToc1, div.MsoToc1
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:5.0pt;
	margin-left:0in;
	line-height:107%;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
p.MsoToc2, li.MsoToc2, div.MsoToc2
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:5.0pt;
	margin-left:11.0pt;
	line-height:107%;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
p.MsoHeader, li.MsoHeader, div.MsoHeader
	{mso-style-link:"Header Char";
	margin:0in;
	margin-bottom:.0001pt;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
p.MsoFooter, li.MsoFooter, div.MsoFooter
	{mso-style-link:"Footer Char";
	margin:0in;
	margin-bottom:.0001pt;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
p.MsoCaption, li.MsoCaption, div.MsoCaption
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:10.0pt;
	margin-left:0in;
	font-size:9.0pt;
	font-family:"Calibri",sans-serif;
	color:#44546A;
	font-style:italic;}
p.MsoTitle, li.MsoTitle, div.MsoTitle
	{mso-style-link:"Title Char";
	margin:0in;
	margin-bottom:.0001pt;
	font-size:28.0pt;
	font-family:"Calibri Light",sans-serif;
	letter-spacing:-.5pt;}
p.MsoTitleCxSpFirst, li.MsoTitleCxSpFirst, div.MsoTitleCxSpFirst
	{mso-style-link:"Title Char";
	margin:0in;
	margin-bottom:.0001pt;
	font-size:28.0pt;
	font-family:"Calibri Light",sans-serif;
	letter-spacing:-.5pt;}
p.MsoTitleCxSpMiddle, li.MsoTitleCxSpMiddle, div.MsoTitleCxSpMiddle
	{mso-style-link:"Title Char";
	margin:0in;
	margin-bottom:.0001pt;
	font-size:28.0pt;
	font-family:"Calibri Light",sans-serif;
	letter-spacing:-.5pt;}
p.MsoTitleCxSpLast, li.MsoTitleCxSpLast, div.MsoTitleCxSpLast
	{mso-style-link:"Title Char";
	margin:0in;
	margin-bottom:.0001pt;
	font-size:28.0pt;
	font-family:"Calibri Light",sans-serif;
	letter-spacing:-.5pt;}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{color:#954F72;
	text-decoration:underline;}
p
	{margin-right:0in;
	margin-left:0in;
	font-size:12.0pt;
	font-family:"Times New Roman",serif;}
code
	{font-family:"Courier New";}
pre
	{mso-style-link:"HTML Preformatted Char";
	margin:0in;
	margin-bottom:.0001pt;
	font-size:10.0pt;
	font-family:"Courier New";}
tt
	{font-family:"Courier New";}
p.MsoAcetate, li.MsoAcetate, div.MsoAcetate
	{mso-style-link:"Balloon Text Char";
	margin:0in;
	margin-bottom:.0001pt;
	font-size:9.0pt;
	font-family:"Segoe UI",sans-serif;}
p.MsoListParagraph, li.MsoListParagraph, div.MsoListParagraph
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:8.0pt;
	margin-left:.5in;
	line-height:107%;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
p.MsoListParagraphCxSpFirst, li.MsoListParagraphCxSpFirst, div.MsoListParagraphCxSpFirst
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.5in;
	margin-bottom:.0001pt;
	line-height:107%;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
p.MsoListParagraphCxSpMiddle, li.MsoListParagraphCxSpMiddle, div.MsoListParagraphCxSpMiddle
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.5in;
	margin-bottom:.0001pt;
	line-height:107%;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
p.MsoListParagraphCxSpLast, li.MsoListParagraphCxSpLast, div.MsoListParagraphCxSpLast
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:8.0pt;
	margin-left:.5in;
	line-height:107%;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
p.MsoTocHeading, li.MsoTocHeading, div.MsoTocHeading
	{margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:0in;
	margin-bottom:.0001pt;
	line-height:107%;
	page-break-after:avoid;
	font-size:16.0pt;
	font-family:"Calibri Light",sans-serif;
	color:#2F5496;}
span.commandline
	{mso-style-name:commandline;}
p.BoxedCode, li.BoxedCode, div.BoxedCode
	{mso-style-name:BoxedCode;
	mso-style-link:"BoxedCode Char";
	margin:0in;
	margin-bottom:.0001pt;
	text-align:justify;
	background:#F9F9F9;
	border:none;
	padding:0in;
	font-size:9.0pt;
	font-family:"Courier New";
	color:black;}
span.BoxedCodeChar
	{mso-style-name:"BoxedCode Char";
	mso-style-link:BoxedCode;
	font-family:"Courier New";
	color:black;
	background:#F9F9F9;}
span.HTMLPreformattedChar
	{mso-style-name:"HTML Preformatted Char";
	mso-style-link:"HTML Preformatted";
	font-family:"Courier New";}
span.line
	{mso-style-name:line;}
span.o
	{mso-style-name:o;}
span.nv
	{mso-style-name:nv;}
span.nt
	{mso-style-name:nt;}
span.Heading3Char
	{mso-style-name:"Heading 3 Char";
	mso-style-link:"Heading 3";
	font-family:"Times New Roman",serif;
	font-weight:bold;}
span.Heading2Char
	{mso-style-name:"Heading 2 Char";
	mso-style-link:"Heading 2";
	font-family:"Calibri Light",sans-serif;
	color:#2F5496;}
span.TitleChar
	{mso-style-name:"Title Char";
	mso-style-link:Title;
	font-family:"Calibri Light",sans-serif;
	letter-spacing:-.5pt;}
span.BalloonTextChar
	{mso-style-name:"Balloon Text Char";
	mso-style-link:"Balloon Text";
	font-family:"Segoe UI",sans-serif;}
span.Heading1Char
	{mso-style-name:"Heading 1 Char";
	mso-style-link:"Heading 1";
	font-family:"Calibri Light",sans-serif;
	color:#2F5496;}
span.c
	{mso-style-name:c;}
span.nb
	{mso-style-name:nb;}
span.se
	{mso-style-name:se;}
span.HeaderChar
	{mso-style-name:"Header Char";
	mso-style-link:Header;}
span.FooterChar
	{mso-style-name:"Footer Char";
	mso-style-link:Footer;}
span.pln
	{mso-style-name:pln;}
span.pun
	{mso-style-name:pun;}
span.str
	{mso-style-name:str;}
p.ibm-h4, li.ibm-h4, div.ibm-h4
	{mso-style-name:ibm-h4;
	margin-right:0in;
	margin-left:0in;
	font-size:12.0pt;
	font-family:"Times New Roman",serif;}
p.ibm-light, li.ibm-light, div.ibm-light
	{mso-style-name:ibm-light;
	margin-right:0in;
	margin-left:0in;
	font-size:12.0pt;
	font-family:"Times New Roman",serif;}
.MsoChpDefault
	{font-family:"Calibri",sans-serif;}
.MsoPapDefault
	{margin-bottom:8.0pt;
	line-height:107%;}
 /* Page Definitions */
 @page WordSection1
	{size:8.5in 11.0in;
	margin:1.0in 1.0in 1.0in 1.0in;}
div.WordSection1
	{page:WordSection1;}
 /* List Definitions */
 ol
	{margin-bottom:0in;}
ul
	{margin-bottom:0in;}
-->
</style>

</head>

<body lang=EN-US link=blue vlink="#954F72">

<div class=WordSection1>

<p class=MsoTitle>Using Enki HPC for AI/ML using Python/Keras/TensorFlow and
GPUs</p>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>Date: Friday, May 29, 2020 <br>
<br>
</p>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoTocHeading>Contents</p>

<p class=MsoToc1><a href="#_Toc17710209">Enki Architeture<span
style='color:windowtext;display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>1</span></a></p>

<p class=MsoToc2><a href="#_Toc17710210">Cluster Layout<span style='color:windowtext;
display:none;text-decoration:none'> </span><span
style='color:windowtext;display:none;text-decoration:none'>1</span></a></p>

<p class=MsoToc2><a href="#_Toc17710211">Head Node Configuration<span
style='color:windowtext;display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>2</span></a></p>

<p class=MsoToc2><a href="#_Toc17710212">Compute Node Configuration<span
style='color:windowtext;display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>2</span></a></p>

<p class=MsoToc1><a href="#_Toc17710213">Enki Computing<span style='color:windowtext;
display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>2</span></a></p>

<p class=MsoToc2><a href="#_Toc17710214">Establish a ssh connection to Enki<span
style='color:windowtext;display:none;text-decoration:none'> </span><span
style='color:windowtext;display:none;text-decoration:none'>2</span></a></p>

<p class=MsoToc2><a href="#_Toc17710215">SLURM<span style='color:windowtext;
display:none;text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>5</span></a></p>

<p class=MsoToc2><a href="#_Toc17710216">Loading files onto enki.<span
style='color:windowtext;display:none;text-decoration:none'> </span><span
style='color:windowtext;display:none;text-decoration:none'>8</span></a></p>

<p class=MsoToc2><a href="#_Toc17710217">Loading AI/ML Keras Tensor Flow
modules<span style='color:windowtext;display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>12</span></a></p>

<p class=MsoToc2><a href="#_Toc17710218">TensorFlow<span style='color:windowtext;
display:none;text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>12</span></a></p>

<p class=MsoToc1><a href="#_Toc17710219">Keras Autokin Enki Shell Script<span
style='color:windowtext;display:none;text-decoration:none'> </span><span
style='color:windowtext;display:none;text-decoration:none'>15</span></a></p>

<p class=MsoToc2><a href="#_Toc17710220">Running Script on Enki Interactively<span
style='color:windowtext;display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>17</span></a></p>

<p class=MsoToc2><a href="#_Toc17710221">Running Script on Enki Batch<span
style='color:windowtext;display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>18</span></a></p>

<p class=MsoToc1><a href="#_Toc17710222">Related<span style='color:windowtext;
display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>18</span></a></p>

<p class=MsoToc2><a href="#_Toc17710223">Vim Notes<span style='color:windowtext;
display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>18</span></a></p>

<p class=MsoToc2><a href="#_Toc17710224">What is Distributed Deep Learning?<span
style='color:windowtext;display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>21</span></a></p>

<p class=MsoToc2><a href="#_Toc17710225">Anaconda Python Package Environment<span
style='color:windowtext;display:none;text-decoration:none'> </span><span
style='color:windowtext;display:none;text-decoration:none'>21</span></a></p>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>&nbsp;</p>

<h1><a name="_Toc17710209">Enki Architeture</a></h1>

<h2><a name="_Toc17710210">Cluster Layout</a></h2>

<p class=MsoNormal>The Enki system comprises a head node and 13 compute nodes.
Each of the 14 machines runs <a
href="https://en.wikipedia.org/wiki/Red_Hat_Enterprise_Linux#RHEL_7"
target="_blank">Red Hat Enterprise Linux 7</a>.</p>

<h2><a name="_Toc17710211">Head Node Configuration</a></h2>

<p class=MsoNormal>The head node, <code><span style='font-size:10.0pt;
line-height:107%'>enki.nist.gov</span></code>, is accessible <em><span
style='font-family:"Calibri",sans-serif'>via</span></em> <a
href="https://en.wikipedia.org/wiki/Comparison_of_SSH_clients" target="_blank">SSH</a>
from any machine on the NIST intranet. It is equipped with 128 GB DDR4 and two <a
href="https://ark.intel.com/products/123547/Intel-Xeon-Silver-4110-Processor-11M-Cache-2_10-GHz"
target="_blank">Intel Xeon Silver 4110</a> CPUs, each with 8 cores (16 threads)
clocked at 2.1 to 3.0 GHz. It is <em><span style='font-family:"Calibri",sans-serif'>not</span></em>
equipped with a <a
href="https://en.wikipedia.org/wiki/General-purpose_computing_on_graphics_processing_units"
target="_blank">GPGPU</a>. The Enki head node is pre-installed with <code><span
style='font-size:10.0pt;line-height:107%'>git</span></code>, <code><span
style='font-size:10.0pt;line-height:107%'>rsync</span></code>, and other
utilities to help import and manage your data.</p>

<h2><a name="_Toc17710212">Compute Node Configuration</a></h2>

<p class=MsoNormal>The compute nodes, <code><span style='font-size:10.0pt;
line-height:107%'>enki[01-13]</span></code>, are accessible <em><span
style='font-family:"Calibri",sans-serif'>via</span></em> <a
href="https://en.wikipedia.org/wiki/OpenSSH" target="_blank">SSH</a> <em><span
style='font-family:"Calibri",sans-serif'>from the head node only</span></em>.
Each compute node is an <a
href="https://www.ibm.com/us-en/marketplace/power-systems-ac922" target="_blank">IBM
Power System AC922 &quot;Witherspoon&quot;</a> HPC server equipped with 575 GB
DDR4 memory and two <a
href="https://www-355.ibm.com/systems/power/openpower/tgcmDocumentRepository.xhtml?aliasId=POWER9_Monza"
target="_blank">IBM POWER9 SMT4 Monza</a> CPUs, each with 20 cores (80 threads)
clocked at 2.25 GHz.</p>

<p class=MsoNormal><em><span style='font-family:"Calibri",sans-serif'>N.B.:
these are </span></em><a href="https://en.wikipedia.org/wiki/Ppc64"
target="_blank"><i>64-bit ppc64le</i></a><em><span style='font-family:"Calibri",sans-serif'>
CPUs capable of 1, 2, or 4-way </span></em><a
href="https://en.wikipedia.org/wiki/Simultaneous_multithreading" target="_blank"><i>SMT</i></a><em><span
style='font-family:"Calibri",sans-serif'>, currently configured for 4-way SMT.</span></em></p>

<p class=MsoNormal>Each Witherspoon node is equipped with four <a
href="https://www.nvidia.com/en-us/data-center/tesla-v100/" target="_blank">Nvidia
Tesla V100 SXM2</a> GPUs, interconnected with the CPU and other GPUs <em><span
style='font-family:"Calibri",sans-serif'>via</span></em> <a
href="https://www.nvidia.com/en-us/data-center/nvlink/" target="_blank">NVLink2</a>
with 150 GB/s bandwidth per direction (in + out, 300 GB/s total per device). Each
V100 has 16 GB HBM2 memory, 5120 CUDA cores, and 640 tensor cores, drawing 300
W under full load.</p>

<p class=MsoNormal>&nbsp;</p>

<h1><a name="_Toc17710213">Enki Computing</a></h1>

<p class=MsoNormal><a href="https://tkphd.ipages.nist.gov/2018-10-03-cuda/">https://tkphd.ipages.nist.gov/2018-10-03-cuda/</a>
has user guide to operations. Following are my notes.</p>

<h2><a name="_Toc17710214">Establish a ssh connection to Enki</a></h2>

<p class=MsoNormal>For windows: (Please note Windows 10 now has openssh, but
this uses putty).</p>

<p class=MsoListParagraphCxSpFirst style='text-indent:-.25in'>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Install
putty: <a href="https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html">https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html</a></p>

<p class=MsoListParagraphCxSpLast style='text-indent:-.25in'>2.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Change
directory to C:\Program Files\PuTTY and then shift-&gt;right click open shell. 
 To generate an SSH public/private key pair in Windows, simply run
&quot;puttygen&quot; in the DOS console or Powershell and this window should
pop up:</p>

<p class=MsoNormal><img border=0 width=624 height=618 id="Picture 1"
src="enki_notes_files/image001.jpg"><br>
<br>
</p>

<p class=MsoListParagraphCxSpFirst style='text-indent:-.25in'>3.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>You
should generate an RSA type-2 key, at least 1024 bits in size, and preferably
larger.  You should also provide a passphrase for your key -- passphrases
should be at least 16 characters long, and must contain digits, letters, and
punctuation.  Unlike passwords, passphrases are allowed to contain spaces and
dictionary words.<br>
<img border=0 width=624 height=618 id="Picture 2"
src="enki_notes_files/image002.jpg"></p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:-.25in'>4.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='font-size:10.0pt;line-height:107%;font-family:"Segoe UI",sans-serif;
color:#444444'>Installation consists of simply adding this key to the
~/.ssh/authorized_keys file on your CTCMS account, and does not require
administrative privileges.&nbsp; Of course, the admin may need to do it for you
if you do not yet have access to the CTCMS system.<br>
<br>
</span></p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:-.25in'>5.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='font-size:10.0pt;line-height:107%;font-family:"Segoe UI",sans-serif;
color:#444444'>To connect, the recommended procedure is to first run
&quot;pageant&quot; (again, probably from the &quot;puTTY&quot; submenu in the
&quot;all programs&quot; menu from the &quot;Start&quot; button).&nbsp; When
you first start &quot;pageant&quot;, it runs in the background, and it may look
like nothing happened.</span></p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:-.25in'>6.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='font-size:10.0pt;line-height:107%;font-family:"Segoe UI",sans-serif;
color:#444444'>To add your private key to your agent, you can right-click on
the pageant icon in the system tray on the bottom right-hand side of the
screen, and select &quot;Add&quot;.&nbsp; The agent will present you with a
file selector, which you should use to navigate to the &quot;.ppk&quot; file.&nbsp;
When adding the key, the agent will prompt you for the passphrase.</span></p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:-.25in'>7.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='font-size:10.0pt;line-height:107%;font-family:"Segoe UI",sans-serif;
color:#444444'>To actually connect, you can now open the &quot;puTTY&quot;
application itself.&nbsp; Basic connection is very simple -- on the default
page of the puTTY window, there is a blank where you can type the name of your
destination machine.&nbsp; Enter enki.nist.gov, and click &quot;connect&quot;.</span></p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:-.25in'><span
style='font-size:10.0pt;line-height:107%;font-family:"Segoe UI",sans-serif;
color:#444444'>8.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-size:10.0pt;line-height:107%;font-family:"Segoe UI",sans-serif;
color:#444444'>The head node, enki.nist.gov, is accessible via the puTTY SSH
from any machine <u>on the NIST intranet</u>. You must have registered, and
once registered it uses your NIST credentials for login authentication. Enki is
a 13-node IBM Power9 system where each node is equipped with 128 GB DDR4 and
two Intel Xeon Silver 4110 CPUs, each with 8 cores (16 threads) clocked at 2.1
to 3.0 GHz. It is not equipped with a GPGPU (</span><span style='font-size:
7.0pt;line-height:107%;font-family:"Segoe UI",sans-serif;color:#444444'>from
Wikipedia</span><span style='font-size:10.0pt;line-height:107%;font-family:
"Segoe UI",sans-serif;color:#444444'>: </span><span style='font-size:7.0pt;
line-height:107%;font-family:"Segoe UI",sans-serif;color:#444444'>General-purpose
computing on graphics processing units (GPGPU, rarely GPGP) is the use of a
graphics processing unit (GPU), which typically handles computation only for
computer graphics, to perform computation in applications traditionally handled
by the central processing unit (CPU).)</span></p>

<p class=MsoListParagraphCxSpLast style='text-indent:-.25in'><span
style='font-size:10.0pt;line-height:107%;font-family:"Segoe UI",sans-serif;
color:#444444'>9.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-size:10.0pt;line-height:107%;font-family:"Segoe UI",sans-serif;
color:#444444'>A dos command shell will pop up. Put in your NIST credentials if
you have already signed up for enki HPCC use.<br>
<br>
</span><img border=0 width=624 height=362 id="Picture 3"
src="enki_notes_files/image003.jpg"><span style='font-size:10.0pt;line-height:
107%;font-family:"Segoe UI",sans-serif;color:#444444'><br>
Now some simple Linux commands to see basic functionality:</span></p>

<div style='border:solid #2F6FAB 1.0pt;padding:12.0pt 12.0pt 12.0pt 9.0pt;
background:#F9F9F9'>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'><span
style='font-size:10.0pt;font-family:"Segoe UI",sans-serif;color:#444444'><br>
</span>michalos@enki:~] $pwd</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>/home/michalos</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>[michalos@enki:~]
$ls -a</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>.  .. 
.bash_logout  .bash_profile  .bashrc  .cache  .config  .emacs  .kshrc 
.mozilla  .ssh  .zshrc</p>

</div>

<p class=MsoListParagraph style='page-break-after:avoid'>&nbsp;</p>

<h2><a name="_Toc17710215">SLURM</a></h2>

<p class=MsoNormal>Next will be a synopsis of tutorial of the SLURM system
found at: <a href="https://slurm.schedmd.com/">https://slurm.schedmd.com/</a>  Slurm
is an open source, fault-tolerant, and highly scalable cluster management and
job scheduling system for large and small Linux clusters.<br>
SLURM has a set of commands on the linux path: scontrol, sinfo, squeue, etc.
sinfo provides general system state. The squeue command  <span
style='color:black;background:white'>determines what jobs exist on the system
for example shown below.</span><br>
<br>
</p>

<p class=MsoNormal><img border=0 width=624 height=377 id="Picture 6"
src="enki_notes_files/image004.jpg"></p>

<p class=MsoNormal>You can start interactive sessions with <span
style='font-size:10.0pt;line-height:107%;font-family:"Courier New"'>srun --pty</span>,
and batch sessions with <span style='font-size:10.0pt;line-height:107%;
font-family:"Courier New"'>sbatch</span>. Use <span style='font-size:10.0pt;
line-height:107%;font-family:"Courier New"'>--gres=gpu:#</span> to request
GPUs. For example, to get all four GPUs and one CPU core on a node (a single
core is the default). The following example requests one hour, zero minutes,
and zero seconds in the highest-priority &quot;debug&quot; partition:</p>

<div style='border:solid #2F6FAB 1.0pt;padding:12.0pt 12.0pt 12.0pt 9.0pt;
background:#F9F9F9'>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>[michalos@enki]$
srun --pty --partition=debug --time=1:00:00 --gres=gpu:1 bash</p>

</div>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>Sbatch is usually included in a bash shell script and starts
an Enki batch program.</p>

<p class=MsoNormal>There are many more options and details on SLURM  can be
found: <a
href="https://gitlab.nist.gov/gitlab/aihpc/pages/wikis/Slurm-Instructions">https://gitlab.nist.gov/gitlab/aihpc/pages/wikis/Slurm-Instructions</a>
<br>
<br>
</p>

<p class=MsoListParagraphCxSpFirst style='text-indent:-.25in;page-break-after:
avoid'>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>Enki specific scripting notes</p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:1.0in;text-indent:-.25in'>a.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>If
you're writing an <code><span style='font-size:10.0pt;line-height:107%'>sbatch</span></code>
script, make sure you set the correct working directory using <code><span
style='font-size:10.0pt;line-height:107%'>-D</span></code>. <u>For best
performance</u>, this would be a path on <code><span style='font-size:10.0pt;
line-height:107%'>/scratch</span></code>, the node-local SSD.<br>
Neither <code><span style='font-size:10.0pt;line-height:107%'>/wrk</span></code>
nor the nodes' <code><span style='font-size:10.0pt;line-height:107%'>/scratch</span></code>
is backed up: please transfer your research results out of Enki as soon as
possible.</p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:1.0in;text-indent:-.25in'>b.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>The
maximum runtime on Enki is 14 days, and it is also the default. This is configured
as a courtesy, to allow long tasks to run without interruption.</p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:1.0in;text-indent:-.25in'>c.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><u>Cross-Compiling
Will Not Work</u> Code compiled on enki will not execute on enki[01-13]! This
is because the enki instruction set (x86-64) is vastly different from the
enki[01-13]s (ppc64le). From <a
href="https://gitlab.nist.gov/gitlab/aihpc/pages/wikis/Cluster-Layout">https://gitlab.nist.gov/gitlab/aihpc/pages/wikis/Cluster-Layout</a>.</p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:1.0in;text-indent:-.25in'>d.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Storage:
<br>
<span style='font-family:Symbol'>·</span>  <code><span style='font-size:10.0pt;
line-height:107%'>/home/$USER</span></code> is shared between nodes and backed
up. 20 TB shared amongst all users, so don't store anything big. Use this to
store programs. <u>This is the slowest storage option</u>.</p>

<p class=MsoListParagraphCxSpLast style='margin-left:1.0in'><span
style='font-family:Symbol'>·</span>  <code><span style='font-size:10.0pt;
line-height:107%'>/wrk</span></code> is shared between nodes and not backed up.
1700 TB shared amongst all users. Create <code><span style='font-size:10.0pt;
line-height:107%'>/wrk/$USER</span></code> and use this for your setting up the
working data needed for your program, and storing large results. It is faster
than <code><span style='font-size:10.0pt;line-height:107%'>/home</span></code>
but slower than <code><span style='font-size:10.0pt;line-height:107%'>/scratch</span></code>.
Some of this will be used for common machine learning data sets
(work-in-progress). </p>

<div style='border:solid #2F6FAB 1.0pt;padding:12.0pt 12.0pt 12.0pt 9.0pt;
background:#F9F9F9;margin-left:1.0in;margin-right:0in'>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>[michalos@enki:~]
$mkdir /wrk/michalos</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>mkdir:
cannot create directory ‘/wrk/michalos’: File exists</p>

</div>

<p class=MsoListParagraphCxSpFirst style='margin-left:1.0in'><br>
<span style='font-family:Symbol'>·</span>  <code><span style='font-size:10.0pt;
line-height:107%'>/scratch</span></code> is private to each node and not backed
up. 5.9 TB per node. This is very fast storage you can use for saving and
reloading intermediate results. Put data in <code><span style='font-size:10.0pt;
line-height:107%'>/scratch/$USER/$SLURM_JOB_ID</span></code> to avoid
collisions. Be nice and clean up after your job is done so other jobs can use
it.</p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:1.0in'>&nbsp;</p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:1.0in;text-indent:-.25in'>e.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>&nbsp;</p>

<p class=MsoListParagraphCxSpLast style='text-indent:-.25in;page-break-after:
avoid'>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>Slurm Flags</p>

<p class=MsoNormal style='margin-left:.5in'>This list should serve as
&quot;Cliff's Notes&quot; for the rest of the page.</p>

<p class=MsoNormal style='margin-left:.75in;text-indent:-.25in;line-height:
normal'><span style='font-size:10.0pt;font-family:Symbol'>·<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><b><span style='font-size:10.0pt;font-family:"Courier New"'>--chdir,
-D</span></b><span style='font-size:12.0pt;font-family:"Times New Roman",serif'>
change directory: should be on </span><span style='font-size:10.0pt;font-family:
"Courier New"'>/wrk</span><span style='font-size:12.0pt;font-family:"Times New Roman",serif'>
or </span><span style='font-size:10.0pt;font-family:"Courier New"'>/scratch</span><span
style='font-size:12.0pt;font-family:"Times New Roman",serif'>. WHY not HOME?</span></p>

<p class=MsoNormal style='margin-left:.75in;text-indent:-.25in;line-height:
normal'><span style='font-size:10.0pt;font-family:Symbol'>·<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><b><span style='font-size:10.0pt;font-family:"Courier New"'>--cpus-per-task,
-c</span></b><span style='font-size:12.0pt;font-family:"Times New Roman",serif'>
number of CPUs (logical cores) required per MPI task (process). Should
generally be equal to the number of threads per task: default is </span><span
style='font-size:10.0pt;font-family:"Courier New"'>-c 1</span><span
style='font-size:12.0pt;font-family:"Times New Roman",serif'>, max is </span><span
style='font-size:10.0pt;font-family:"Courier New"'>160</span><span
style='font-size:12.0pt;font-family:"Times New Roman",serif'>.</span></p>

<p class=MsoNormal style='margin-left:.75in;text-indent:-.25in;line-height:
normal'><span style='font-size:10.0pt;font-family:Symbol'>·<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><b><span style='font-size:10.0pt;font-family:"Courier New"'>--gres</span></b><span
style='font-size:12.0pt;font-family:"Times New Roman",serif'> number of
accelerators: default is </span><span style='font-size:10.0pt;font-family:"Courier New"'>--gres=gpu:0</span><span
style='font-size:12.0pt;font-family:"Times New Roman",serif'>, max is </span><span
style='font-size:10.0pt;font-family:"Courier New"'>gpu:4</span><span
style='font-size:12.0pt;font-family:"Times New Roman",serif'>.</span></p>

<p class=MsoNormal style='margin-left:.75in;text-indent:-.25in;line-height:
normal'><span style='font-size:10.0pt;font-family:Symbol'>·<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><b><span style='font-size:10.0pt;font-family:"Courier New"'>--nodes,
-N</span></b><span style='font-size:12.0pt;font-family:"Times New Roman",serif'>
required number of nodes: default is </span><span style='font-size:10.0pt;
font-family:"Courier New"'>-N 1</span><span style='font-size:12.0pt;font-family:
"Times New Roman",serif'>, max is </span><span style='font-size:10.0pt;
font-family:"Courier New"'>13</span><span style='font-size:12.0pt;font-family:
"Times New Roman",serif'>.</span></p>

<p class=MsoNormal style='margin-left:.75in;text-indent:-.25in;line-height:
normal'><span style='font-size:10.0pt;font-family:Symbol'>·<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><b><span style='font-size:10.0pt;font-family:"Courier New"'>--ntask,
-n</span></b><span style='font-size:12.0pt;font-family:"Times New Roman",serif'>
total number of MPI tasks (processes): default is </span><span
style='font-size:10.0pt;font-family:"Courier New"'>-n 1</span><span
style='font-size:12.0pt;font-family:"Times New Roman",serif'>.</span></p>

<p class=MsoNormal style='margin-left:.75in;text-indent:-.25in;line-height:
normal'><span style='font-size:10.0pt;font-family:Symbol'>·<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><b><span style='font-size:10.0pt;font-family:"Courier New"'>--pty</span></b><span
style='font-size:12.0pt;font-family:"Times New Roman",serif'> interactive mode:
default is <i>off</i> </span></p>

<p class=MsoNormal style='margin-left:.75in;text-indent:-.25in;line-height:
normal'><span style='font-size:10.0pt;font-family:Symbol'>·<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><b><span style='font-size:10.0pt;font-family:"Courier New"'>--time,
-t</span></b><span style='font-size:12.0pt;font-family:"Times New Roman",serif'>
maximum runtime (d-hh:mm:ss): default is </span><span style='font-size:10.0pt;
font-family:"Courier New"'>-t 14-00:00:00</span><span style='font-size:12.0pt;
font-family:"Times New Roman",serif'>, max is </span><span style='font-size:
10.0pt;font-family:"Courier New"'>14-00:00:00</span><span style='font-size:
12.0pt;font-family:"Times New Roman",serif'> (two weeks).</span></p>

<p class=MsoNormal style='margin-left:.75in;text-indent:-.25in;line-height:
normal'><span style='font-size:10.0pt;font-family:Symbol'>·<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><b><span style='font-size:10.0pt;font-family:"Courier New"'>--ntasks-per-core=1</span></b><span
style='font-size:12.0pt;font-family:"Times New Roman",serif'> indicates to
OpenMPI that each task should run on an separate core; without this then
OpenMPI gets confused and binds everything to one thread.</span></p>

<p class=MsoNormal style='margin-left:.75in;text-indent:-.25in;line-height:
normal'><span style='font-size:10.0pt;font-family:Symbol'>·<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><b><span style='font-size:10.0pt;font-family:"Courier New"'>--exclusive</span></b><span
style='font-size:12.0pt;font-family:"Times New Roman",serif'> indicates that
the node should not be shared with other running jobs; </span><b><span
style='font-size:10.0pt;font-family:"Courier New"'>--exclusive=user</span></b><span
style='font-size:12.0pt;font-family:"Times New Roman",serif'> indicates that it
should not be shared with other users.</span></p>

<p class=MsoNormal style='margin-left:.75in;text-indent:-.25in;line-height:
normal'><span style='font-size:10.0pt;font-family:Symbol'>·<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><b><span style='font-size:10.0pt;font-family:"Courier New"'>-w
enki##</span></b><span style='font-size:12.0pt;font-family:"Times New Roman",serif'>
runs on node ##</span></p>

<p class=MsoNormal>&nbsp;</p>

<h2><a name="_Toc17710216">Loading files onto enki.</a> </h2>

<p class=MsoNormal>We will use winscp although there are other options.  NOTE
there is a problem with carriage return/line feed convention between windows
and linux. dos2unix is not included in the red hat distribution. I ended up
using vim and the command. I used vim and the vim command  :set fileformat=unix  
It seems to work, as things bomb indiscriminantly with the wrong end of line
convention.</p>

<p class=MsoNormal>Download winscp from <a
href="https://winscp.net/eng/download.php">https://winscp.net/eng/download.php</a>
and install and run.</p>

<p class=MsoNormal>A split screen WINSCP dialog will pop up and you will need
to log in.</p>

<p class=MsoNormal><img border=0 width=624 height=419 id="Picture 7"
src="enki_notes_files/image005.jpg"></p>

<p class=MsoNormal>This assumes you have already logged in using putty and put
your ssh file in $HOME/.ssh.</p>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal><img border=0 width=624 height=446 id="Picture 8"
src="enki_notes_files/image006.jpg"></p>

<p class=MsoNormal>[TODO PUT IN IMAGE OF LOGIN DIALOG]</p>

<p class=MsoNormal><img border=0 width=570 height=450 id="Picture 9"
src="enki_notes_files/image007.png"></p>

<p class=MsoNormal><img border=0 width=570 height=450 id="Picture 10"
src="enki_notes_files/image008.png"><br>
Put in your NIST gene login password.</p>

<p class=MsoNormal>Then just select the files you want to transfer and then
drag over to the Enki sie.</p>

<p class=MsoNormal><img border=0 width=624 height=353 id="Picture 12"
src="enki_notes_files/image009.jpg"></p>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>Instead of using winscp you can use github to clone or pull
latest version of a project.  My project was not big enough to worry about
this.</p>

<h2>&nbsp;</h2>

<h2><a name="_Toc17710217">Loading AI/ML Keras Tensor Flow modules</a></h2>

<p class=MsoNormal>Following the instructions found at: <a
href="https://gitlab.nist.gov/gitlab/aihpc/pages/wikis/Deep-Learning">https://gitlab.nist.gov/gitlab/aihpc/pages/wikis/Deep-Learning</a></p>

<p class=MsoNormal>TensorFlow, PyTorch, and Caffe2 are included via <a
href="https://developer.ibm.com/linuxonpower/deep-learning-powerai/releases/"
target="_blank">Watson Machine Learning Community Edition (formerly PowerAI)</a>. 
The Watson Machine Learn Community Edition (WML CE) packages are distributed as
Conda packages in an online Conda repository. Package dependencies are
automatically resolved and CUDA, cuDNN, and NCCL are packaged as Conda packages
installed by WML CE.</p>

<p class=MsoNormal>Since our AI/ML program uses Keras with a tensorflow
backend, we will investigate the required steps.</p>

<h2><a name="_Toc17710218">TensorFlow</a></h2>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>Note!  IBM has deprecated. IBM PowerAI ML/DL packages
including tensorflow. From an interactive session (described below) is the
output from use the &quot;module load&quot; command:</p>

<div style='border:solid #2F6FAB 1.0pt;padding:12.0pt 12.0pt 12.0pt 9.0pt;
background:#F9F9F9'>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>[michalos@enki13:~/autokin]
$module load powerAI/tensorflow</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>DEPRECATION:
this module powerAI/tensorflow has been deprecated. IBM PowerAI ML/DL packages
are now distributed as Conda packages. See
https://www.ibm.com/support/knowledgecenter/SS5SF7_1.6.0/navigation/pai_install.htm
for more details.</p>

</div>

<p class=MsoNormal>As a result, only Anaconda/conda instructions are provided
to set up the gpu environment.</p>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>To run TensorFlow first create an interactive enki job 
session, set up the Anaconda environment properly, and then create an Anaconda
environment for your TensorFlow application, you use conda create to make an
Anaconda environment and MUST use conda to install the appropriate powerpc
python modules. Below is a ssh session performing these tasks:</p>

<div style='border:solid #2F6FAB 1.0pt;padding:12.0pt 12.0pt 12.0pt 9.0pt;
background:#F9F9F9'>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'><span
class=c># start up an interactive session</span></p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'><span
class=o>[</span><span class=line>michalos@enki]</span><span class=nv>$ </span><span
class=line>srun </span><span class=nt>-p</span><span class=line> debug </span><span
class=nt>-t</span><span class=line> 60:00 </span><span class=nt>-n</span><span
class=line> 1 </span><span class=nt>--pty</span><span class=line> bash</span></p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'><span
class=o>[</span><span class=line>michalos@node]</span><span class=nv>$ </span><span
class=nb>source</span><span class=line> /opt/anaconda3/etc/profile.d/conda.sh</span></p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'><span
class=o>[</span><span class=line>michalos@node]</span><span class=nv>$ </span><span
class=line>conda config </span><span class=nt>--prepend</span><span class=line>
channels </span><span class=se>\</span></p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'><span
class=line>https://public.dhe.ibm.com/ibmdl/export/pub/software/server/ibm-ai/conda/</span></p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'><span
class=o>[</span><span class=line>michalos@node]</span><span class=nv>$ </span><span
class=nb>mkdir envs</span></p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'><span
class=o>[</span><span class=line>michalos@node]</span><span class=nv>$ </span>conda
create --prefix  envs/autokin python=3.6</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'><span
class=o>[</span><span class=line>michalos@node]</span><span class=nv>$ </span>conda
activate /home/michalos/envs/autokin</p>

</div>

<p class=MsoNormal>First, create an interactive job session into the powerpc
world</p>

<div style='border:solid #2F6FAB 1.0pt;padding:12.0pt 12.0pt 12.0pt 9.0pt;
background:#F9F9F9'>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'><span
class=line>srun </span><span class=nt>-p</span><span class=line> debug </span><span
class=nt>-t</span><span class=line> 60:00 </span><span class=nt>-n</span><span
class=line> 1 </span><span class=nt>--pty</span><span class=line> bash</span> </p>

</div>

<p class=MsoNormal>Then the conda environment must be set up properly with the
following commd:</p>

<div style='border:solid #2F6FAB 1.0pt;padding:12.0pt 12.0pt 12.0pt 9.0pt;
background:#F9F9F9'>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>&gt; source
/opt/anaconda3/etc/profile.d/conda.sh</p>

</div>

<p class=MsoNormal>Conda then must be configured to give priority to installing
packages from the IBM channel.  Add the PowerAI channel to your Conda
configuration by running the following command:</p>

<div style='border:solid #2F6FAB 1.0pt;padding:12.0pt 12.0pt 12.0pt 9.0pt;
background:#F9F9F9'>

<p class=BoxedCode align=left style='text-align:left;background:#F9F9F9;
border:none;padding:0in'>&gt; conda config --prepend channels \</p>

<p class=BoxedCode align=left style='text-align:left;background:#F9F9F9;
border:none;padding:0in'> https://public.dhe.ibm.com/ibmdl/export/pub/software/server/ibm-ai/conda/</p>

</div>

<p class=MsoNormal>Then a user environment must be established for conda where
the only valid Python versions with WML CE are Python 2.7 and 3.6.</p>

<div style='border:solid #2F6FAB 1.0pt;padding:12.0pt 12.0pt 12.0pt 9.0pt;
background:#F9F9F9'>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'><span
class=o>[</span><span class=line>michalos@node]</span><span class=nv>$ </span><span
class=nb>mkdir envs</span></p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'><span
class=o>[</span><span class=line>michalos@node]</span><span class=nv>$ </span>conda
create --prefix  envs/autokin python=3.6</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'><span
class=o>[</span><span class=line>michalos@node]</span><span class=nv>$ </span>conda
activate /home/michalos/envs/autokin</p>

</div>

<p class=MsoNormal>Check that conda python environment was created:</p>

<div style='border:solid #2F6FAB 1.0pt;padding:12.0pt 12.0pt 12.0pt 9.0pt;
background:#F9F9F9'>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>[michalos@enki:~]
$conda info --envs</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'># conda
environments:</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>#</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>                        
/home/michalos/envs/autokin</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>base                 
*  /opt/anaconda3</p>

</div>

<p class=MsoNormal>Now we would like to install tensorflow-gpu into our conda
environment. We would like to get the latest, which can be done using pip (i.e.
pip search tensorflow) however pip will get non-powerpc module  builds, AND WE
ONLY WANT POWERPC. So we need to use conda. </p>

<div style='border:solid #2F6FAB 1.0pt;padding:12.0pt 12.0pt 12.0pt 9.0pt;
background:#F9F9F9'>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'><span
class=o>[</span><span class=line>michalos@node]</span><span class=nv>$</span>
conda install tensorflow-gpu</p>

</div>

<p class=MsoNormal>You should get the following output for the loaded python
modules:</p>

<div style='border:solid #2F6FAB 1.0pt;padding:12.0pt 12.0pt 12.0pt 9.0pt;
background:#F9F9F9'>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>The
following NEW packages will be INSTALLED:</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>&nbsp;</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'> 
_tflow_select      ibmdl/export/pub/software/server/ibm-ai/conda/linux-ppc64le::_tflow_select-2.1.0-gpu_723.g2e92f34</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'> 
absl-py            pkgs/main/linux-ppc64le::absl-py-0.7.1-py36_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'> 
astor              pkgs/main/linux-ppc64le::astor-0.7.1-py36_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'> 
c-ares             pkgs/main/linux-ppc64le::c-ares-1.15.0-h7b6447c_1001</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'> 
cudatoolkit       
ibmdl/export/pub/software/server/ibm-ai/conda/linux-ppc64le::cudatoolkit-10.1.168-533.g8d035fd</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'> 
cudnn             
ibmdl/export/pub/software/server/ibm-ai/conda/linux-ppc64le::cudnn-7.5.1_10.1-507.gcdf2330</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'> 
gast               pkgs/main/linux-ppc64le::gast-0.2.2-py36_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'> 
google-pasta      
ibmdl/export/pub/software/server/ibm-ai/conda/linux-ppc64le::google-pasta-0.1.6-py36_482.gde1dc70</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'> 
graphsurgeon       ibmdl/export/pub/software/server/ibm-ai/conda/linux-ppc64le::graphsurgeon-0.4.1-py36_515.gdfe9810</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'> 
grpcio             pkgs/main/linux-ppc64le::grpcio-1.16.1-py36hf8bcb03_1</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>  nccl              
ibmdl/export/pub/software/server/ibm-ai/conda/linux-ppc64le::nccl-2.4.7-501.g7a305d1</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'> 
powerai-license   
ibmdl/export/pub/software/server/ibm-ai/conda/linux-ppc64le::powerai-license-1.6.1-627.gc80b92e</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'> 
tensorboard        ibmdl/export/pub/software/server/ibm-ai/conda/linux-ppc64le::tensorboard-1.14.0-py36_d2a1b9e_3334.gb94cdc6</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'> 
tensorflow        
ibmdl/export/pub/software/server/ibm-ai/conda/linux-ppc64le::tensorflow-1.14.0-gpu_py36_733.gb94cdc6</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'> 
tensorflow-base    ibmdl/export/pub/software/server/ibm-ai/conda/linux-ppc64le::tensorflow-base-1.14.0-gpu_py36_87989f6_57051.gd288838</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'> 
tensorflow-estima~
ibmdl/export/pub/software/server/ibm-ai/conda/linux-ppc64le::tensorflow-estimator-1.14.0-py36_a031b45_1136.gb94cdc6</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'> 
tensorflow-gpu     ibmdl/export/pub/software/server/ibm-ai/conda/linux-ppc64le::tensorflow-gpu-1.14.0-733.gb94cdc6</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'> 
tensorrt          
ibmdl/export/pub/software/server/ibm-ai/conda/linux-ppc64le::tensorrt-5.1.3.6-py36_515.gdfe9810</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'> 
termcolor          pkgs/main/linux-ppc64le::termcolor-1.1.0-py36_1</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'> 
uff               
ibmdl/export/pub/software/server/ibm-ai/conda/linux-ppc64le::uff-0.6.3-py36_515.gdfe9810</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'> 
wrapt              pkgs/main/linux-ppc64le::wrapt-1.10.11-py36h14c3975_2</p>

</div>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>Now we will try an interactive python to test to conda
environment (^D)Log off and log back on to make sure .bashrc changes are
working:</p>

<div style='border:solid #2F6FAB 1.0pt;padding:12.0pt 12.0pt 12.0pt 9.0pt;
background:#F9F9F9'>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'><span
class=o>[</span><span class=line>michalos@enki]</span><span class=nv>$ </span><span
class=line>srun </span><span class=nt>-p</span><span class=line> debug </span><span
class=nt>-t</span><span class=line> 60:00 </span><span class=nt>-n</span><span
class=line> 1 </span><span class=nt>--pty</span><span class=line> bash</span></p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>[michalos@enki07:~]
$source /opt/anaconda3/etc/profile.d/conda.sh</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>[michalos@enki07:~]
$conda config --prepend channels \</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>&gt;
https://public.dhe.ibm.com/ibmdl/export/pub/software/server/ibm-ai/conda/</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>[michalos@enki07:~]
$conda activate /home/michalos/envs/autokin</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>(autokin)
[michalos@enki07:~] $python3</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>Python
3.6.9 |Anaconda, Inc.| (default, Jul 30 2019, 19:18:58)</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>[GCC 7.3.0]
on linux</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>Type
&quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or
&quot;license&quot; for more information.</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>&gt;&gt;&gt;
import tensorflow as tf; print(tf.__version__)</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>1.2.1</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>&gt;&gt;&gt;
(^D)</p>

</div>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>Now try a test sbatch file tf.slurm whose code is:</p>

<div style='border:solid #2F6FAB 1.0pt;padding:12.0pt 12.0pt 12.0pt 9.0pt;
background:#F9F9F9'>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>#!/bin/bash</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>#SBATCH
-J tensorflow-test</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>#SBATCH
-p gpu</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>#SBATCH
--mail-type=end</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>#SBATCH
--mail-user=john.michaloski@nist.gov</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>#SBATCH
-o %j.out</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>#SBATCH
-e %j.err</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>#SBATCH
-n 1</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>&nbsp;</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>source
/opt/anaconda3/etc/profile.d/conda.sh</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>conda
activate /home/michalos/envs/autokin</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>python -c
'import tensorflow as tf; print(tf.__version__)</p>

</div>

<p class=MsoNormal>&nbsp;</p>

<div style='border:solid #2F6FAB 1.0pt;padding:12.0pt 12.0pt 12.0pt 9.0pt;
background:#F9F9F9'>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>(autokin)
[michalos@enki07:~] $ chmod +x tf.slurm</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>(autokin)
[michalos@enki07:~] $ ./tf.slurm</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>1.2.1</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>(autokin)
[michalos@enki07:~] $</p>

</div>

<p class=MsoNormal><span style='color:black;background:#FDFDFD'>You can monitor
your job’s status via&nbsp;</span><code><span style='font-size:11.5pt;
line-height:107%;color:#111111;background:#EEEEFF'>squeue. </span></code>So
bring up another putty ssh and see the status.</p>

<div style='border:solid #2F6FAB 1.0pt;padding:12.0pt 12.0pt 12.0pt 9.0pt;
background:#F9F9F9'>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>[michalos@enki:~]
$squeue -u michalos</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>            
JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>            
99201     debug     bash michalos  R      45:47      1 enki07</p>

</div>

<p class=MsoNormal>This is the interactive debug session.</p>

<h1><a name="_Toc17710219">Keras Autokin Enki Shell Script</a></h1>

<p class=MsoNormal>Based on the Enki shell script found at <a
href="https://gitlab.nist.gov/gitlab/mmajursk/Object-Detection/blob/master/Yolo_v3/launch_train_sbatch.sh">https://gitlab.nist.gov/gitlab/mmajursk/Object-Detection/blob/master/Yolo_v3/launch_train_sbatch.sh</a>
a shell script  file incorporating sbatch was coded.</p>

<div style='border:solid #2F6FAB 1.0pt;padding:12.0pt 12.0pt 12.0pt 9.0pt;
background:#F9F9F9'>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>#!/usr/bin/bash</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>#
**************************</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'># MODIFY
THESE OPTIONS</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>&nbsp;</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>#SBATCH
--partition=gpu</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>#SBATCH
--nodes=1</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>#SBATCH
--cpus-per-task=160</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>#SBATCH
--gres=gpu:4</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>#SBATCH
--job-name=y3</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>#SBATCH
--time=72:0:0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>#SBATCH
-o y3-%N.%j.out</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>&nbsp;</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>#########################################</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'># Name of
experiment</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>experiment_name=&quot;autokin-$(date
+%Y%m%dT%H%M%S)&quot;</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>echo
&quot;Experiment: $experiment_name&quot;</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>&nbsp;</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>&nbsp;</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>#########################################</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'># Define
the term handler function</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'># note
that this is not executed here, but rather</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'># when
the associated signal is sent</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>term_handler()</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>{</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>       
echo &quot;function term_handler called.  Cleaning up and Exiting&quot;</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>        #
Do nothing</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>       
exit -1</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>}</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>&nbsp;</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>#
associate the function &quot;term_handler&quot; with the TERM signal</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>trap 'term_handler'
TERM</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>&nbsp;</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>&nbsp;</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>&nbsp;</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>#########################################</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'># FOLDERS</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>input_data_directory=&quot;/wrk/michalos/autokin&quot;</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>output_directory=&quot;/wrk/michalos/autokin&quot;</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>scratch_dir=&quot;/scratch/${SLURM_JOB_ID}&quot;</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>results_dir=&quot;$output_directory/$experiment_name&quot;</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>&nbsp;</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>mkdir -p
${results_dir}</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>mkdir -p
&quot;$results_dir/src&quot;</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>cp -r .
&quot;$results_dir/src&quot;</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>&nbsp;</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>echo
&quot;Input Directory: $input_data_directory&quot;</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>echo
&quot;Output Directory: $output_directory&quot;</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>echo
&quot;Results Directory: $results_dir&quot;</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>echo
&quot;Scratch Directory: $scratch_dir&quot;</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>echo
&quot;Working directory contains: &quot;</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>ls
${scratch_dir}</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>&nbsp;</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>&nbsp;</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>#########################################</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'># DATA</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>data_file=&quot;kindata.csv&quot;</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>&nbsp;</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'># copy
data to node</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>echo
&quot;Copying data to Node&quot;</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>cp -r
${input_data_directory}/${data_file} ${scratch_dir}/${data_file}</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>echo
&quot;data copy to node complete&quot;</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>&nbsp;</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>#########################################</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'># job
configuration</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>&nbsp;</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>&nbsp;</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>&nbsp;</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>#########################################</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'># set
conda environment - this should have all the imports</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>source
/opt/anaconda3/etc/profile.d/conda.sh</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>conda
activate /home/michalos/envs/autokin</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>conda
config --prepend channels \</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>  
https://public.dhe.ibm.com/ibmdl/export/pub/software/server/ibm-ai/conda/</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>conda
activate /home/michalos/envs/autokin</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>&nbsp;</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>#########################################</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'># launch
training script with required options</p>

<p class=BoxedCode align=left style='text-align:left;background:#F9F9F9;
border:none;padding:0in'>echo &quot;Launching simple automated variable tuning
Script&quot;</p>

<p class=BoxedCode align=left style='text-align:left;background:#F9F9F9;
border:none;padding:0in'>python3 AutoTreeGeneration.py 
--dataset=&quot;$scratch_dir/$data_file&quot; 
--output_dir=&quot;$results_dir&quot;  | tee &quot;$results_dir/log.txt&quot;</p>

<p class=BoxedCode align=left style='text-align:left;background:#F9F9F9;
border:none;padding:0in'>echo &quot;Job completed&quot;</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>&nbsp;</p>

</div>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>&nbsp;</p>

<h2><a name="_Toc17710220">Running Script on Enki Interactively</a></h2>

<p class=MsoNormal>Log into enki using putty ssh as described earlier. Then, log
into cluster using srun:</p>

<div style='border:solid #2F6FAB 1.0pt;padding:12.0pt 12.0pt 12.0pt 9.0pt;
background:#F9F9F9'>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>srun -p
debug -t 12:00:00 -n 1 --pty bash  # 1/2 day</p>

</div>

<p class=MsoNormal>Or miss piggy:</p>

<div style='border:solid #2F6FAB 1.0pt;padding:12.0pt 12.0pt 12.0pt 9.0pt;
background:#F9F9F9'>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>srun <span
class=nt><span style='font-size:10.0pt'>--partition</span></span><span class=o><span
style='font-size:10.0pt'>=</span></span><code><span style='font-size:10.0pt'>debug</span></code>
 --time 3-00:00:00 --cpus-per-task  160 --gres=gpu:4  --pty bash   # 3 days </p>

</div>

<p class=MsoNormal>Make sure the script is executable</p>

<div style='border:solid #2F6FAB 1.0pt;padding:12.0pt 12.0pt 12.0pt 9.0pt;
background:#F9F9F9'>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>[michalos@enki05:~/autokin]
$chmod +x launch_autokin_sbatch.sh</p>

</div>

<p class=MsoNormal>run shell script</p>

<div style='border:solid #2F6FAB 1.0pt;padding:12.0pt 12.0pt 12.0pt 9.0pt;
background:#F9F9F9'>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>[michalos@enki05:~/autokin]
$./launch_autokin_sbatch.sh</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>Experiment:
autokin-20190821T114826</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>Input
Directory: /wrk/michalos/autokin</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>Output
Directory: /wrk/michalos/autokin</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>Results
Directory: /wrk/michalos/autokin/autokin-20190821T114826</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>Scratch
Directory: /scratch/99271</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>Working
directory contains:</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>Copying
data to Node</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>data copy
to node complete</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>Warning:
'https://public.dhe.ibm.com/ibmdl/export/pub/software/server/ibm-ai/conda/'
already in 'channels' list, moving to the top</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>Launching
simple automated variable tuning Script</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>Traceback
(most recent call last):</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>  File
&quot;AutoTreeGeneration.py&quot;, line 6, in &lt;module&gt;</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>   
import matplotlib.pyplot as plt</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>ModuleNotFoundError:
No module named 'matplotlib'</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>Job
completed</p>

</div>

<p class=MsoNormal>In total, was missing matplotlib and pandas and scikit-learn
(sklearn), so these python modules were added to the autokin conda environment,
which caused downgrading of several python packages/modules.</p>

<div style='border:solid #2F6FAB 1.0pt;padding:12.0pt 12.0pt 12.0pt 9.0pt;
background:#F9F9F9'>

<p class=BoxedCode align=left style='text-align:left;background:#F9F9F9;
border:none;padding:0in'>&gt; source /opt/anaconda3/etc/profile.d/conda.sh</p>

<p class=BoxedCode align=left style='text-align:left;background:#F9F9F9;
border:none;padding:0in'>[michalos@enki05:~/autokin]  conda config --prepend
channels\</p>

<p class=BoxedCode align=left style='text-align:left;background:#F9F9F9;
border:none;padding:0in'> <a
href="https://public.dhe.ibm.com/ibmdl/export/pub/software/server/ibm-ai/conda/">https://public.dhe.ibm.com/ibmdl/export/pub/software/server/ibm-ai/conda/</a></p>

<p class=BoxedCode align=left style='text-align:left;background:#F9F9F9;
border:none;padding:0in'> </p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>[michalos@enki05:~/autokin]
$ conda install matplotlib pandas scikit-learn</p>

</div>

<p class=MsoNormal>It appears as if Keras module install covered the other
required python modules, e.g., tensorflow etc.</p>

<p class=MsoNormal>Now run the shell script interactively:</p>

<div style='border:solid #2F6FAB 1.0pt;padding:12.0pt 12.0pt 12.0pt 9.0pt;
background:#F9F9F9'>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>./launch_autokin_sbatch.sh</p>

</div>

<h2><a name="_Toc17710221">Running Script on Enki Batch</a></h2>

<p class=MsoNormal style='line-height:normal'><span style='font-size:12.0pt;
font-family:"Times New Roman",serif'>Once you have the file prepared, you can
submit it by:</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:10.0pt;font-family:"Courier New"'>[user@enki]$
sbatch file</span></p>

<p class=MsoNormal style='line-height:normal'><span style='font-size:12.0pt;
font-family:"Times New Roman",serif'>The output will be a job number assigned
by the queuing system. The job will be dispatched once sufficient resources are
available. Unless otherwise redirected, standard output from the job will
appear in a file named &quot;slurm-&lt;job#&gt;.out&quot; in the directory
where the &quot;sbatch&quot; command was issued.</span></p>

<div style='border:solid #2F6FAB 1.0pt;padding:12.0pt 12.0pt 12.0pt 9.0pt;
background:#F9F9F9'>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>sbatch launch_autokin_sbatch.sh</p>

</div>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>The output will be a job number assigned by the queuing
system. The job will be dispatched once sufficient resources are available.
Unless otherwise redirected, standard output from the job will appear in a file
named &quot;slurm-&lt;job#&gt;.out&quot; in the directory where the
&quot;sbatch&quot; command was issued.</p>

<p class=MsoNormal>The normal method to kill a Slurm job is:</p>

<div style='border:solid #2F6FAB 1.0pt;padding:12.0pt 12.0pt 12.0pt 9.0pt;
background:#F9F9F9'>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>scancel
&lt;jobid&gt;</p>

</div>

<p class=MsoNormal>Do it twice, check that your job is no longer in squeue.</p>

<p class=MsoNormal>&nbsp;</p>

<h1><a name="_Toc17710222">Related</a></h1>

<h2><a name="_Toc17710223">Vim Notes</a></h2>

<p class=MsoNormal>Editing was done with vim, as emacs </p>

<p class=MsoNormal>Most macro commands use a prefix &quot;:&quot;. To get to
command bar hit &quot;:&quot; and then here are some basics:</p>

<div style='border:solid #2F6FAB 1.0pt;padding:12.0pt 12.0pt 12.0pt 9.0pt;
background:#F9F9F9'>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>INSERT
MODE   (hit Esc to retract)</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>:w (write
file)</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>:q (quit)</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>:q!
(abort quit – no saves, no questions,)</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>:set
fileformat=unix  (convert dos file to unix)</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'><span
style='font-size:10.0pt;font-family:Consolas;color:#242729;background:#EFF0F1'>:%s/\r+//g
</span>(convert dos file to unix)</p>

</div>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>Of note, the conversion from DOS/WINDOWS to Linux line feed
conversion seems to be best handled in vim by:</p>

<div style='border:solid #2F6FAB 1.0pt;padding:12.0pt 12.0pt 12.0pt 9.0pt;
background:#F9F9F9'>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>:set
fileformat=unix  (convert dos file to unix)</p>

</div>

<p class=MsoNormal>And using vim from the command line:</p>

<div style='border:solid #2F6FAB 1.0pt;padding:12.0pt 12.0pt 12.0pt 9.0pt;
background:#F9F9F9'>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'><span
style='background:#EFF0F1'>vim file.txt -c </span><span style='color:#7D2727;
background:#EFF0F1'>&quot;set ff=unix&quot;</span><span style='background:#EFF0F1'>
-c </span><span style='color:#7D2727;background:#EFF0F1'>&quot;:wq&quot;</span></p>

</div>

<p class=MsoNormal>And as a pipe command</p>

<div style='border:solid #2F6FAB 1.0pt;padding:12.0pt 12.0pt 12.0pt 9.0pt;
background:#F9F9F9'>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'><span
style='background:#EFF0F1'>find . -name '*.py' -exec vim {} -c </span><span
style='color:#7D2727;background:#EFF0F1'>&quot;set ff=unix&quot;</span><span
style='background:#EFF0F1'> -c </span><span style='color:#7D2727;background:
#EFF0F1'>&quot;:wq&quot;</span><span style='background:#EFF0F1'> \;</span></p>

</div>

<p class=MsoNormal>Don't do this in your home directory or you will change
every .conda/*.py file….</p>

<p class=MsoNormal>&nbsp;</p>

<div style='border:solid #2F6FAB 1.0pt;padding:12.0pt 12.0pt 12.0pt 9.0pt;
background:#F9F9F9'>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>&nbsp;</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>(autokin)
[michalos@enki05:~/autokin] $conda list</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>#
packages in environment at /home/michalos/envs/autokin:</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>#</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>#
Name                    Version                   Build  Channel</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>_libgcc_mutex            
0.1                        main</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>backports                
1.0                        py_2</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>backports.weakref        
1.0rc1                   py36_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>blas                     
1.0                    openblas</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>bleach                   
1.5.0                    py36_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>ca-certificates          
2019.5.15                     1</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>certifi                
  2019.6.16                py36_1</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>cycler                   
0.10.0                   py36_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>freetype                 
2.9.1                h8a8886c_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>h5py                     
2.8.0            py36h8d01980_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>hdf5                     
1.10.2               hba1933b_1</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>html5lib                 
0.9999999                py36_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>icu                      
58.2                 h64fc554_1</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>keras                    
2.2.2                         0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>keras-applications       
1.0.4                    py36_1</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>keras-base   
            2.2.2                    py36_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>keras-preprocessing      
1.0.2                    py36_1</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>kiwisolver               
1.1.0            py36he6710b0_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>libedit                  
3.1.20181209         hc058e9b_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>libffi                   
3.2.1                hf62a594_5</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>libgcc-ng                
8.2.0                h822a55f_1</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>libgfortran-ng           
7.3.0                h822a55f_1</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>libopenblas              
0.3.6                h5a2b251_1</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>libpng                   
1.6.37               hbc83047_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>libprotobuf              
3.8.0                hd408876_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>libstdcxx-ng             
8.2.0                h822a55f_1</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>markdown                 
3.1.1                    py36_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>matplotlib               
3.1.0            py36h5429711_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>ncurses                  
6.1                  he6710b0_1</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>numpy                    
1.16.4           py36h99e49ec_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>numpy-base               
1.16.4           py36h2f8d375_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>openssl                  
1.1.1c               h7b6447c_1</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>pandas                   
0.25.0           py36he6710b0_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>pip                      
19.2.2                   py36_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>protobuf                 
3.8.0            py36he6710b0_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>pyparsing                
2.4.2                      py_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>python                   
3.6.9                h2bede3c_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>python-dateutil          
2.8.0                    py36_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>pytz                     
2019.2                     py_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>pyyaml                   
5.1.2            py36h7b6447c_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>readline                 
7.0                  h7b6447c_5</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>scipy               
     1.3.0            py36he2b7bc3_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>setuptools               
41.0.1                   py36_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>six                      
1.12.0                   py36_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>sqlite                   
3.29.0               h7b6447c_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>tensorflow               
1.2.1                    py36_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>tk                       
8.6.8                hbc83047_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>tornado                  
6.0.3            py36h7b6447c_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>werkzeug                 
0.15.5                     py_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>wheel                    
0.33.4                   py36_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>xz        
               5.2.4                h14c3975_4</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>yaml                     
0.1.7                h1bed415_2</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>zlib                     
1.2.11               h7b6447c_3</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>(autokin)
[michalos@enki05:~/autokin] $</p>

</div>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>And the bad news is getting access to the HPC as it is often
hogged by a couple of heavy duty users:</p>

<p class=MsoNormal>[michalos@enki:~/autokin] $squeue</p>

<div style='border:solid #2F6FAB 1.0pt;padding:12.0pt 12.0pt 12.0pt 9.0pt;
background:#F9F9F9'>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>            
JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>            
99297     debug     bash michalos PD       0:00      1 (PartitionTimeLimit)</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>            
99263       gpu job_scri    snh15  R    5:19:20      1 enki07</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>            
99242       gpu vgg_pola      lyg  R   16:27:57      1 enki04</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>            
99241       gpu vgg_pola      lyg  R   16:28:32      1 enki03</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>            
99240       gpu vgg_pola      lyg  R   16:28:41      1 enki03</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>            
99239       gpu vgg_pola      lyg  R   16:28:56      1 enki02</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>            
99238       gpu vgg_pola      lyg  R   16:29:08      1 enki02</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>             99049      
gpu vgg_pola      lyg  R 4-20:50:36      1 enki06</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>            
99061       gpu C2N_stra  smolyan  R 3-10:36:37      1 enki01</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>            
99251       gpu slurmGpu     dja3  R    5:47:28      1 enki13</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>            
99121       gpu C2N_stra  smolyan  R 2-00:20:48      1 enki12</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>            
99116       gpu     bash     znw7  R 2-00:32:13      1 enki03</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>            
99110       gpu     bash     znw7  R 2-00:48:08      1 enki06</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>            
99109       gpu     bash     znw7  R 2-00:51:05      1 enki04</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>            
99108       gpu     bash     znw7  R 2-00:52:23      1 enki04</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>            
99107       gpu     bash     znw7  R 2-00:53:26      1 enki04</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>            
99106       gpu     bash     znw7  R 2-00:54:53      1 enki02</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>            
99074       gpu     bash     znw7  R 2-04:50:58      1 enki05</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>            
99031       gpu     bash     znw7  R 5-00:37:48      2 enki[02-03]</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>            
98924       gpu     bash     znw7  R 6-22:44:18      2 enki[10-11]</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>&nbsp;</p>

</div>

<h2><a name="_Toc17710224">What is Distributed Deep Learning?</a></h2>

<p class=ibm-light style='margin:0in;margin-bottom:.0001pt;background:white;
vertical-align:baseline'><span style='font-family:"Arial",sans-serif;
color:#323232'>Distributed Deep Learning (DDL) is a MPI-based communication
library, which is specifically optimized for deep learning training. An
application integrated with DDL becomes an MPI-application, which will allow
the use of the&nbsp;</span><code><span style='font-size:10.0pt;font-family:
Courier;color:#323232'>ddlrun</span></code><span style='font-family:"Arial",sans-serif;
color:#323232'>&nbsp;command to invoke the job in parallel across a cluster of
systems. DDL understands multi-tier network environment and uses different
libraries (e.g. NCCL) and algorithms to get the best performance in multi-node,
multi-GPU environments.</span></p>

<p class=ibm-light style='margin:0in;margin-bottom:.0001pt;background:white;
vertical-align:baseline'><span style='font-family:"Arial",sans-serif;
color:#323232'>&nbsp;</span></p>

<p class=ibm-light style='margin:0in;margin-bottom:.0001pt;background:white;
vertical-align:baseline'><span style='font-family:"Arial",sans-serif;
color:#323232'>Check out this performance proof-point that shows how DDL
maximized research productivity by training on more images at the same time
with TensorFlow 1.4.0 running on a cluster of IBM Power System AC922 servers
with Nvidia Tesla V100 GPUs connected via NVLink 2.0:&nbsp;</span><span
style='color:black'><a
href="https://developer.ibm.com/linuxonpower/perfcol/perfcol-mldl#tab_tensorflow4"
target="_blank"><span style='font-family:"Arial",sans-serif;color:#3B6CAA'>Distributed
Deep Learning: IBM POWER9™ with Nvidia Tesla V100 results in 2.3X more data
processed on TensorFlow versus tested x86 systems.</span></a></span></p>

<div style='border:solid #2F6FAB 1.0pt;padding:12.0pt 12.0pt 12.0pt 9.0pt;
background:#F9F9F9'>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>&nbsp;</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>&nbsp;</p>

</div>

<p class=MsoNormal>&nbsp;</p>

<h2><a name="_Toc17710225">Anaconda Python Package Environment</a></h2>

<div style='border:solid #2F6FAB 1.0pt;padding:12.0pt 12.0pt 12.0pt 9.0pt;
background:#F9F9F9'>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>(autokin)
[michalos@enki13:~/autokin] $conda list</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>#
packages in environment at /home/michalos/envs/autokin:</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>#</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>#
Name                    Version                   Build  Channel</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>_libgcc_mutex            
0.1                        main</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>_tflow_select       
     2.1.0           gpu_723.g2e92f34   
https://public.dhe.ibm.com/ibmdl/export/pub/software/server/ibm-ai/conda</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>absl-py                  
0.7.1                    py36_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>astor                    
0.7.1                    py36_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>backports                
1.0                        py_2</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>backports.weakref        
1.0rc1                   py36_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>blas                     
1.0                    openblas</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>bleach                   
1.5.0                    py36_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>c-ares                   
1.15.0            h7b6447c_1001</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>ca-certificates          
2019.5.15                     1</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>certifi                  
2019.6.16                py36_1</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>cudatoolkit              
10.1.168           533.g8d035fd   
https://public.dhe.ibm.com/ibmdl/export/pub/software/server/ibm-ai/conda</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>cudnn                    
7.5.1_10.1         507.gcdf2330   
https://public.dhe.ibm.com/ibmdl/export/pub/software/server/ibm-ai/conda</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>cycler                   
0.10.0                   py36_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>freetype                 
2.9.1                h8a8886c_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>gast                     
0.2.2                    py36_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>google-pasta             
0.1.6           py36_482.gde1dc70   
https://public.dhe.ibm.com/ibmdl/export/pub/software/server/ibm-ai/conda</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>graphsurgeon             
0.4.1           py36_515.gdfe9810   
https://public.dhe.ibm.com/ibmdl/export/pub/software/server/ibm-ai/conda</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>grpcio                   
1.16.1           py36hf8bcb03_1</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>h5py                     
2.8.0            py36h8d01980_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>hdf5           
          1.10.2               hba1933b_1</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>html5lib                 
0.9999999                py36_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>icu                      
58.2                 h64fc554_1</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>keras                    
2.2.2                    pypi_0    pypi</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>keras-applications       
1.0.4                    pypi_0    pypi</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>keras-base               
2.2.4           py36_536.gd8f7d7c   
https://public.dhe.ibm.com/ibmdl/export/pub/software/server/ibm-ai/conda</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>keras-preprocessing      
1.1.0                    pypi_0    pypi</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>kiwisolver         
      1.1.0            py36he6710b0_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>libedit                  
3.1.20181209         hc058e9b_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>libffi                   
3.2.1                hf62a594_5</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>libgcc-ng                
8.2.0                h822a55f_1</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>libgfortran-ng           
7.3.0                h822a55f_1</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>libopenblas              
0.2.20               h9ac9557_7</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>libpng                   
1.6.37               hbc83047_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>libprotobuf              
3.7.1              494.g6f829d7   
https://public.dhe.ibm.com/ibmdl/export/pub/software/server/ibm-ai/conda</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>libstdcxx-ng             
8.2.0                h822a55f_1</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>markdown                 
3.1.1                    py36_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>matplotlib               
3.1.0            py36h5429711_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>nccl                     
2.4.7              501.g7a305d1    https://public.dhe.ibm.com/ibmdl/export/pub/software/server/ibm-ai/conda</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>ncurses                  
6.1                  he6710b0_1</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>numpy                    
1.14.5           py36h2aefc1b_4</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>numpy-base               
1.14.5           py36h2b20989_4</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>openssl                  
1.1.1c               h7b6447c_1</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>pandas                   
0.25.0           py36he6710b0_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>pip                      
19.2.2                   py36_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>powerai-license          
1.6.1              627.gc80b92e    https://public.dhe.ibm.com/ibmdl/export/pub/software/server/ibm-ai/conda</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>powerai-release          
1.6.1              488.g24b6af4   
https://public.dhe.ibm.com/ibmdl/export/pub/software/server/ibm-ai/conda</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>protobuf                 
3.7.1           py36_504.g85ad89d    https://public.dhe.ibm.com/ibmdl/export/pub/software/server/ibm-ai/conda</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>pyparsing                
2.4.2                      py_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>python                   
3.6.9                h2bede3c_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>python-dateutil          
2.8.0                    py36_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>pytz                  
   2019.2                     py_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>pyyaml                   
5.1.2            py36h7b6447c_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>readline                 
7.0                  h7b6447c_5</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>scikit-learn             
0.19.1           py36h6cfcb94_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>scipy                    
1.1.0            py36h9c1e066_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>setuptools               
41.0.1                   py36_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>six                      
1.12.0                   py36_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>sqlite                   
3.29.0               h7b6447c_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>tensorboard              
1.14.0          py36_d2a1b9e_3334.gb94cdc6    https://public.dhe.ibm.com/ibmdl/export/pub/software/server/ibm-ai/conda</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>tensorflow               
1.14.0          gpu_py36_733.gb94cdc6   
https://public.dhe.ibm.com/ibmdl/export/pub/software/server/ibm-ai/conda</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>tensorflow-base          
1.14.0          gpu_py36_87989f6_57051.gd288838   
https://public.dhe.ibm.com/ibmdl/export/pub/software/server/ibm-ai/conda</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>tensorflow-estimator     
1.14.0          py36_a031b45_1136.gb94cdc6   
https://public.dhe.ibm.com/ibmdl/export/pub/software/server/ibm-ai/conda</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>tensorflow-gpu           
1.14.0             733.gb94cdc6   
https://public.dhe.ibm.com/ibmdl/export/pub/software/server/ibm-ai/conda</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>tensorrt                 
5.1.3.6         py36_515.gdfe9810   
https://public.dhe.ibm.com/ibmdl/export/pub/software/server/ibm-ai/conda</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>termcolor                
1.1.0                    py36_1</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>tk                       
8.6.8                hbc83047_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>tornado                  
6.0.3            py36h7b6447c_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>uff                      
0.6.3           py36_515.gdfe9810    https://public.dhe.ibm.com/ibmdl/export/pub/software/server/ibm-ai/conda</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>werkzeug                 
0.14.1                   py36_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>wheel                    
0.33.4                   py36_0</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>wrapt                    
1.10.11          py36h14c3975_2</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>xz                       
5.2.4                h14c3975_4</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>yaml                     
0.1.7                h1bed415_2</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>zlib                     
1.2.11               h7b6447c_3</p>

<p class=BoxedCode style='background:#F9F9F9;border:none;padding:0in'>(autokin)
[michalos@enki13:~/autokin] $</p>

</div>

</div>

</body>

</html>
